# KubeCon Day 3

## Keynote

### Zero Trust

This isnt about security, it's about trust.

establish enough trust in a system to perform a task. like testing the teperature of a bath.

what do we mean by trust? it's not a property of a system. it's based on other properties.

trust is an assessment, trust is a decision. trust is assymetrical. 

information overload degrades trust in tooling.

Trust framework

- contextual
- time sesitive
- assymetrical

Trust in computer systems in the cloud

What can we do?

- Patch management
- user account management
- awareness programs
- ask what happens if trust is violated

### Realtime media in k8s

- camera feed sent to studio
- mixing
- encoding
- distribution to cdn
- delivery over hls/dash

how does internet streaming work

http requests media playlist from server.

client gets media segments from server

repeat.

how does live video over ip work?

rtsp

client gets media streams for url from server

client and server negotiate udp ports for stream

server streams media to client ovr udp

#### K8s

kube-proxy & nodeport, no realtime
service mesg & load balances, no udp, no real time
host networking, everyhting, one pod per node.
mediastreaming mesh, no http, realtime media well.

#### Media Streaming Mesh

MSM Gateway pods with RTP Proxy and MSM stub.

Client checks msm stub, checks control plane, connects to msm stub endpoint in video stream pod. traffic will flow to proxy closest, sent across to rtp proxy on the node user connected too.

Benefits

- Observability, measure jitter and packet loss
- Security
- Distribution, replicate streams optimally
- Deployability, optimise cluster footprint.

github.com/media-streaming-mesh

### is k8s delivering on its promise

Shopify platform engineer experience

#### Key stakeholders

app devs, dont want to deal with complexity of infra, want building blocks, want golden path, full integration from dev flow.

Pms, fast time to market, avoid costly prod issues, security and compliance

platform engineers, scalabilioty, reliability, extnsibility

#### using a diy orchestrator

bash scripts, ssh into host, restart containers, no autoscaling.

app
service catalog
logging, ci/cd/security
orchestration
cmdb
networking
compute.

needed an army of experts. iaas + tools + best practice.

#### promise of k8s.

scalable container management platform, infra agnostic.

ready to assemble building blkocks, get started in only a few weeks. improved usbaility for app devs.

#### evaluation

portability - 5 stars, skills are portable regardless of underlying infra
reliability - 5 stars, architecturally designed for reliability
extensibility - 5 stars, custom resources, plugins etc.
scalability - 3 stars, good at scale, but limits/other constraints apply.
simplicity - 1 star, powerful but complex system.

##### complexities

yaml config complexity. managing at global scale.
painful k8s upgrades
multi-cluster management.

###### options to deal with complexity

simplest

- cloud + managed service (AKS/EKS)
- platform on cloud (build on top of vms)
- vendor platform
- build your own k8s platform.

most flexibility

Platform teams love kubernetes

## 1M lines of YAML at shopify

1500 app config sets, 1m lines of yaml, 350 prod clusters

Intent Management.

declarative abstractions are primary.

### Starting a platform

App init, pick a stack.

ERB. embed ruby in config files. It went bad. people did crazy stuff with it. e.g http calls. no interface. high learning curve.

rolling back was not deterministic. yaml re-rendered each deploy.

### New system

- safety, repeatable, revievable
- maintainable, programatical make updates reliably, versioned.
- universality, simple to start, modify, fast. arbitrary customization.

Config CLI -> helps author -> Config API -> generates -> Review Artifact -> generates -> Release Artifact <- pulls Release tool.

#### Config CLI

runtime add, edit, upgrade

#### Config API

yaml custom resource type. manifest.yaml.

#### Review artifact

manifest.yaml.lock, autogenerated from above, easier to compare changes.

#### rlrease artifact

autogenerated from above. replaces artifact refs to the real commit hash. cant do this earlier, because its part of the same repo and ci pipeline, it doesnt exist above. persisted in seperate repo.

-----

Kustomize does something like this.

### Principles

- give users a way to express their intent
- automate any changes your distributing widely
- make consequential changes visible.
- create release artifacts as early as possible.
- make it modular, allow apps to enter at any stage of the workflow. e.g dont need to use the config cli.

### MVP

Config API -> generates -> Release Artifact.

### KRM Functions frameowkr, config api toolkit

kubernetes resource model

```
apiVersion
kind
metadata
   name
```

krm function, a piece of code that performs crud on local resource
krm function spec. a standard
krm function framework. a toolkit in go.

a toolkit for writing go code that generates local k8s config.

validates and defaults the yaml.

## The next Log4shell, preparing for CVEs with eBPF

Log4Shell, allows remote code execution. 

send malicious string to vuln web app jndi:ldap://a

connects to attackers ldap server

executes java class.

how can we detect unpactched software, how do we know our clusters are safe, how can we detect if we've been compomised.

### eBPF

extend linux kernel with security and observability context/.

extend linux kernel to be kubenerntes aware.

can be hooked in at most kernel calls.

what can we answer?

- what binaries are running
- what versions are these
- what network connections are open
- is the network healthy
- what files are being accessed
- are connections encrypted
- is tls compliant?

constraints

- realtime
- minimal cpu
- offline and online

Tetragon, security observability and runtime enforcement

a framework to hook into the kernel, check stuff, and a mechanism to pull the results out of the kernel.

export the json events to SIEM (splunk)

check for late process execution (5 mins after start), detects remote shell exec as malicious.

prevention.

apply leasy priveledged principle for network connections.

DNS based policy, only allow FQDNs, not static IPs, use cilium.

## Building an Open Source Observability stack


